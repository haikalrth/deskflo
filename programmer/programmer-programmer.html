<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Programmer - DeskFlo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8fafc; /* bg-slate-50 */
      }
      .modal-backdrop {
        transition: opacity 0.3s ease;
      }
      .modal-content {
        transition: transform 0.3s ease;
      }
      .dropdown-menu {
        transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
      }
    </style>
  </head>
  <body class="text-slate-800">
    <div class="flex h-screen bg-slate-50">
      <!-- Sidebar -->
      <aside class="w-64 bg-white shadow-sm flex-shrink-0">
        <div class="p-6 flex items-center space-x-3">
          <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
          </div>
          <span class="text-xl font-bold text-slate-800">DeskFlo</span>
        </div>
        <nav class="mt-6 px-4">
          <a href="dashboard-programmer.html" class="flex items-center px-4 py-3 text-slate-600 hover:bg-slate-100 rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
            </svg>
            Dashboard
          </a>
          <a href="programmer-programmer.html" class="flex items-center px-4 py-3 mt-2 bg-slate-100 text-indigo-600 font-semibold rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor">
              <path
                d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0112 8a5 5 0 014.5 4.33A6.97 6.97 0 0017 16c0 .34.024.673.07 1h-4.14zM6.07 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 016 8a5 5 0 014.5 4.33A6.97 6.97 0 0011 16c0 .34.024.673.07 1H6.07z"
              />
            </svg>
            Programmer
          </a>
          <a href="calendar-programmer.html" class="flex items-center px-4 py-3 mt-2 text-slate-600 hover:bg-slate-100 rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V4a1 1 0 10-2 0v1H7V4a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
            </svg>
            Calendar
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 flex flex-col h-screen overflow-y-hidden">
        <header class="sticky top-0 z-10 bg-white/80 backdrop-blur-sm border-b border-slate-200 p-6 flex justify-between items-center">
          <h1 class="text-xl font-semibold text-slate-900">Daftar Programmer</h1>
          <div class="flex items-center space-x-5">
            <div class="relative">
              <button id="notification-button" class="text-slate-500 hover:text-slate-800 relative">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                  />
                </svg>
                <span id="notification-indicator" class="absolute -top-1 -right-1 flex h-3 w-3"
                  ><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-rose-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-rose-500"></span
                ></span>
              </button>
              <div id="notification-dropdown" class="dropdown-menu absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg py-1 z-50 hidden opacity-0 transform scale-95">
                <div class="px-4 py-2 font-semibold text-slate-800 border-b">Notifikasi</div>
                <div id="notification-list">
                  <a href="#" class="block px-4 py-3 text-sm text-slate-700 hover:bg-slate-100">
                    <p class="font-medium text-rose-600">Revisi Diperlukan</p>
                    <p class="text-xs text-slate-500">Tugas "Perbaikan Alur Pembayaran" memerlukan revisi.</p>
                  </a>
                  <a href="#" class="block px-4 py-3 text-sm text-slate-700 hover:bg-slate-100">
                    <p class="font-medium text-emerald-600">Tugas Disetujui</p>
                    <p class="text-xs text-slate-500">"Fixing Bug on Login Page" telah disetujui oleh manajer.</p>
                  </a>
                </div>
              </div>
            </div>
            <div class="relative">
              <div id="profile-button" class="flex items-center space-x-3 cursor-pointer">
                <img class="w-10 h-10 rounded-full object-cover" src="https://placehold.co/100x100/ec4899/ffffff?text=B" alt="Programmer Avatar" />
                <div>
                  <p class="font-semibold text-sm">Budi Santoso</p>
                  <p class="text-xs text-slate-500">Programmer</p>
                </div>
              </div>
              <div id="profile-dropdown" class="dropdown-menu absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg py-1 z-50 hidden opacity-0 transform scale-95">
                <a href="edit-profile-programmer.html?from=programmer-programmer.html" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Edit Profil</a>
                <a href="#" id="logout-button" class="block px-4 py-2 text-sm text-rose-600 hover:bg-rose-50">Log Out</a>
              </div>
            </div>
          </div>
        </header>

        <div class="flex-1 overflow-y-auto">
          <div class="p-8">
            <div class="bg-white p-4 rounded-xl shadow-sm mb-6">
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <input id="search-input" type="text" placeholder="Cari nama atau NPM..." class="w-full px-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                <select id="team-filter" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                  <option value="">Semua Tim</option>
                  <option>Tim Frontend</option>
                  <option>Tim API</option>
                  <option>Tim QA</option>
                </select>
                <select id="status-filter" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                  <option value="">Semua Status</option>
                  <option>On Task</option>
                  <option>Standby</option>
                  <option>On Leave</option>
                </select>
                <button id="apply-filter-button" class="bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700">Terapkan Filter</button>
              </div>
            </div>
            <div class="w-full">
              <div class="grid grid-cols-6 gap-4 px-6 py-3 text-xs font-semibold text-slate-500 uppercase">
                <div class="col-span-1">Nama</div>
                <div class="col-span-1">NPM</div>
                <div class="col-span-1">Jurusan</div>
                <div class="col-span-1">Tim</div>
                <div class="col-span-1">Status</div>
                <div class="col-span-1">Tugas Aktif</div>
              </div>
              <div id="programmer-table-body" class="mt-2 space-y-2"></div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- All Tasks Modal -->
    <div id="all-tasks-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden modal-backdrop opacity-0">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg transform scale-95 modal-content">
        <div class="flex justify-between items-center p-6 border-b">
          <h3 id="modal-programmer-name" class="text-xl font-bold">Daftar Tugas</h3>
          <button class="close-modal-button text-slate-500 hover:text-slate-800">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
          </button>
        </div>
        <div id="modal-task-list" class="p-6 space-y-3 max-h-[60vh] overflow-y-auto">
          <!-- Task list will be injected here -->
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // --- Mock Data ---
        const programmers = [
          { id: 1, name: "Budi Santoso", npm: "1234567890", major: "Teknik Informatika", email: "budi@example.com", teams: ["Tim API"], role: "Programmer", status: "On Task", activeTaskIds: [4, 8] },
          { id: 2, name: "Citra Lestari", npm: "1234567891", major: "Sistem Informasi", email: "citra@example.com", teams: ["Tim Frontend"], role: "Programmer", status: "Standby", activeTaskIds: [] },
          { id: 3, name: "Doni Firmansyah", npm: "1234567892", major: "Teknik Komputer", email: "doni@example.com", teams: ["Tim Frontend", "Tim API"], role: "Programmer", status: "On Task", activeTaskIds: [2] },
          { id: 4, name: "Eka Putri", npm: "1234567893", major: "Teknik Informatika", email: "eka@example.com", teams: ["Tim QA"], role: "Programmer", status: "On Leave", activeTaskIds: [] },
        ];

        const mockTasks = {
          2: { title: "UI Slicing Halaman Checkout", project: "Fitur Pembayaran V2" },
          4: { title: "Fixing Bug on Login Page", project: "Tugas Individual" },
          8: { title: "Refactor Kode Controller", project: "Tugas Individual" },
        };

        // --- Table Rendering ---
        const tableBody = document.getElementById("programmer-table-body");

        function renderProgrammerTable(dataToRender = programmers) {
          tableBody.innerHTML = "";
          dataToRender.forEach((p) => {
            const row = document.createElement("div");
            row.className = "grid grid-cols-6 gap-4 items-center bg-white p-4 rounded-lg shadow-sm border border-slate-200";

            const teamTags = p.teams
              .map((team) => {
                let colorClass = "bg-gray-100 text-gray-800";
                if (team === "Tim API") colorClass = "bg-rose-100 text-rose-800";
                if (team === "Tim Frontend") colorClass = "bg-blue-100 text-blue-800";
                if (team === "Tim QA") colorClass = "bg-green-100 text-green-800";
                return `<span class="text-xs font-medium px-2 py-0.5 rounded-full ${colorClass}">${team}</span>`;
              })
              .join("");

            let statusHtml = "";
            if (p.status === "On Task") statusHtml = `<span class="flex items-center text-emerald-600"><span class="h-2 w-2 rounded-full bg-emerald-500 mr-2"></span>On Task</span>`;
            else if (p.status === "Standby") statusHtml = `<span class="flex items-center text-amber-600"><span class="h-2 w-2 rounded-full bg-amber-500 mr-2"></span>Standby</span>`;
            else statusHtml = `<span class="flex items-center text-slate-500"><span class="h-2 w-2 rounded-full bg-slate-400 mr-2"></span>On Leave</span>`;

            let taskHtml = '<span class="text-slate-400">-</span>';
            if (p.activeTaskIds.length > 0) {
              taskHtml = `<button class="font-medium text-indigo-600 hover:underline open-tasks-modal" data-programmer-id="${p.id}">${p.activeTaskIds.length} Tugas Aktif</button>`;
            }

            row.innerHTML = `
                    <div class="col-span-1 font-semibold text-slate-900">${p.name}</div>
                    <div class="col-span-1 text-slate-600">${p.npm}</div>
                    <div class="col-span-1 text-slate-600">${p.major}</div>
                    <div class="col-span-1 flex flex-wrap gap-1">${teamTags}</div>
                    <div class="col-span-1">${statusHtml}</div>
                    <div class="col-span-1">${taskHtml}</div>
                  `;
            tableBody.appendChild(row);
          });

          attachAllTasksModalListeners();
        }

        // --- Modal Management ---
        const allTasksModal = document.getElementById("all-tasks-modal");
        const closeModalButtons = document.querySelectorAll(".close-modal-button");

        const openModal = (modal) => {
          modal.classList.remove("hidden");
          setTimeout(() => {
            modal.classList.remove("opacity-0");
            modal.querySelector(".modal-content").classList.remove("scale-95");
          }, 10);
        };

        const closeModal = (modal) => {
          if (modal) {
            modal.classList.add("opacity-0");
            modal.querySelector(".modal-content").classList.add("scale-95");
            setTimeout(() => modal.classList.add("hidden"), 300);
          }
        };

        closeModalButtons.forEach((button) => {
          button.addEventListener("click", (e) => {
            const modalToClose = e.target.closest(".modal-backdrop");
            if (modalToClose) closeModal(modalToClose);
          });
        });

        // --- All Tasks Modal Logic ---
        const modalProgrammerName = document.getElementById("modal-programmer-name");
        const modalTaskList = document.getElementById("modal-task-list");

        function attachAllTasksModalListeners() {
          const openTasksModalButtons = document.querySelectorAll(".open-tasks-modal");
          openTasksModalButtons.forEach((button) => {
            button.addEventListener("click", () => {
              const programmerId = button.getAttribute("data-programmer-id");
              const programmer = programmers.find((p) => p.id == programmerId);

              if (programmer) {
                modalProgrammerName.textContent = `Tugas Aktif: ${programmer.name}`;
                modalTaskList.innerHTML = ""; // Clear previous list

                if (programmer.activeTaskIds.length > 0) {
                  programmer.activeTaskIds.forEach((taskId) => {
                    const task = mockTasks[taskId];
                    if (task) {
                      const taskEl = document.createElement("div");
                      taskEl.className = "bg-slate-50 p-3 rounded-lg border";
                      taskEl.innerHTML = `<p class="font-semibold text-slate-800">${task.title}</p><p class="text-xs text-slate-500">Proyek: ${task.project}</p>`;
                      modalTaskList.appendChild(taskEl);
                    }
                  });
                } else {
                  modalTaskList.innerHTML = '<p class="text-slate-500 text-center">Tidak ada tugas aktif.</p>';
                }

                openModal(allTasksModal);
              }
            });
          });
        }

        // --- Filter Logic ---
        const searchInput = document.getElementById("search-input");
        const teamFilter = document.getElementById("team-filter");
        const statusFilter = document.getElementById("status-filter");
        const applyFilterButton = document.getElementById("apply-filter-button");

        function applyFilters() {
          const searchTerm = searchInput.value.toLowerCase();
          const selectedTeam = teamFilter.value;
          const selectedStatus = statusFilter.value;

          const filteredData = programmers.filter((p) => {
            const nameMatch = p.name.toLowerCase().includes(searchTerm);
            const npmMatch = p.npm.includes(searchTerm);
            const teamMatch = !selectedTeam || p.teams.includes(selectedTeam);
            const statusMatch = !selectedStatus || p.status === selectedStatus;

            return (nameMatch || npmMatch) && teamMatch && statusMatch;
          });

          renderProgrammerTable(filteredData);
        }

        applyFilterButton.addEventListener("click", applyFilters);

        // --- Dropdown Logic ---
        const profileButton = document.getElementById("profile-button");
        const profileDropdown = document.getElementById("profile-dropdown");
        const notificationButton = document.getElementById("notification-button");
        const notificationDropdown = document.getElementById("notification-dropdown");
        const notificationIndicator = document.getElementById("notification-indicator");

        function closeAllDropdowns() {
          if (profileDropdown && !profileDropdown.classList.contains("hidden")) {
            profileDropdown.classList.add("opacity-0", "scale-95");
            setTimeout(() => profileDropdown.classList.add("hidden"), 200);
          }
          if (notificationDropdown && !notificationDropdown.classList.contains("hidden")) {
            notificationDropdown.classList.add("opacity-0", "scale-95");
            setTimeout(() => notificationDropdown.classList.add("hidden"), 200);
          }
        }

        function toggleDropdown(dropdownToToggle) {
          if (!dropdownToToggle) return;
          const isHidden = dropdownToToggle.classList.contains("hidden");
          closeAllDropdowns();
          if (isHidden) {
            dropdownToToggle.classList.remove("hidden");
            setTimeout(() => {
              dropdownToToggle.classList.remove("opacity-0", "scale-95");
            }, 10);
          }
        }

        if (profileButton) {
          profileButton.addEventListener("click", (e) => {
            e.stopPropagation();
            toggleDropdown(profileDropdown);
          });
        }
        if (notificationButton) {
          notificationButton.addEventListener("click", (e) => {
            e.stopPropagation();
            if (notificationIndicator) notificationIndicator.classList.add("hidden");
            toggleDropdown(notificationDropdown);
          });
        }
        window.addEventListener("click", () => closeAllDropdowns());

        // --- Logout Logic ---
        const logoutButton = document.getElementById("logout-button");
        if (logoutButton) {
          logoutButton.addEventListener("click", (e) => {
            e.preventDefault();
            console.log("Logging out...");
            window.location.href = "../authentication.html?status=logout_success";
          });
        }

        // Initial Render
        renderProgrammerTable();
      });
    </script>
  </body>
</html>
